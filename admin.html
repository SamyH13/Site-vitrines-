<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Admin ‚Äî March√© Provence</title>
<style>
  body{font-family:system-ui,Inter,Arial,sans-serif;margin:0;background:#faf7ef;color:#1e1a17}
  header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #e6ddca;background:#fff;position:sticky;top:0;z-index:10}
  .btn{padding:10px 14px;border:1px solid #d9cfbc;border-radius:10px;background:#fff;cursor:pointer}
  .btn.primary{background:#1e1a17;color:#fff;border-color:#1e1a17}
  .btn.danger{background:#ffefef;border-color:#ffd3d3}
  .tabs{display:flex;gap:8px;padding:10px 16px;border-bottom:1px solid #e6ddca;background:#fff;position:sticky;top:58px;z-index:9}
  .tab{padding:8px 12px;border-radius:999px;border:1px solid #e6ddca;background:#fff;cursor:pointer}
  .tab.active{background:#1e1a17;color:#fff;border-color:#1e1a17}
  .wrap{padding:16px;max-width:1100px;margin:auto}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .card{background:#fff;border:1px solid #e6ddca;border-radius:12px;padding:14px}
  label{font-size:14px;color:#5b5248}
  input,textarea,select{width:100%;padding:10px;border:1px solid #d9cfbc;border-radius:10px;margin-top:6px;font-family:inherit}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  .list{display:grid;gap:10px;max-height:64vh;overflow:auto}
  .item{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;border:1px solid #eee;border-radius:10px;padding:8px;background:#fff}
  .item img{width:64px;height:64px;object-fit:cover;border-radius:8px;border:1px solid #eee}
  .pill{font-size:12px;padding:2px 8px;border:1px solid #e1d6c2;border-radius:999px;background:#faf6ee;display:inline-block;margin-left:6px}
  .muted{color:#7a7168;font-size:13px}
  .hide{display:none}
  .login{max-width:420px;margin:50px auto}
  @media (max-width:900px){.grid,.row,.row3{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <b>Admin ‚Äî March√© Provence</b>
  <div>
    <span id="who" class="muted"></span>
    <button id="logout" class="btn hide">Se d√©connecter</button>
  </div>
</header>

<div class="tabs">
  <button class="tab active" data-tab="tab-products">Produits</button>
  <button class="tab" data-tab="tab-markets">March√©s</button>
</div>

<!-- LOGIN -->
<section id="loginView" class="login">
  <div class="card">
    <h3>Connexion</h3>
    <div class="muted">Acc√®s r√©serv√©</div>
    <div class="row" style="margin-top:10px">
      <div>
        <label>Email</label>
        <input id="email" type="email" placeholder="toi@exemple.com">
      </div>
      <div>
        <label>Mot de passe</label>
        <input id="pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>
    </div>
    <button id="login" class="btn" style="margin-top:12px">Se connecter</button>
    <div id="loginMsg" class="muted" style="margin-top:8px"></div>
  </div>
</section>

<!-- APP -->
<section id="appView" class="wrap hide">

  <!-- ======= PRODUITS ======= -->
  <div id="tab-products">
    <div class="grid">
      <!-- FORM PRODUIT -->
      <div class="card">
        <h3 id="prodFormTitle">Nouveau produit</h3>
        <div class="row">
          <div>
            <label>Nom</label>
            <input id="p_name" type="text">
          </div>
          <div>
            <label>Cat√©gorie</label>
            <input id="p_cat" type="text">
          </div>
        </div>
        <div class="row">
          <div>
            <label>Prix (‚Ç¨)</label>
            <input id="p_price" type="number" step="0.01" min="0" value="0">
          </div>
          <div>
            <label>Stock</label>
            <input id="p_stock" type="number" min="0" value="0">
          </div>
        </div>
        <div>
          <label>Description</label>
          <textarea id="p_desc" rows="3"></textarea>
        </div>
        <div class="row">
          <div>
            <label>Image</label>
            <input id="p_file" type="file" accept="image/*">
          </div>
          <div>
            <label>Ordre</label>
            <input id="p_order" type="number" value="0">
          </div>
        </div>
        <div style="margin-top:12px">
          <label><input id="p_active" type="checkbox" checked> Actif</label>
        </div>
        <div style="display:flex;gap:10px;margin-top:12px">
          <button id="p_save" class="btn primary">Enregistrer</button>
          <button id="p_reset" class="btn">R√©initialiser</button>
          <button id="p_del" class="btn danger hide">Supprimer</button>
        </div>
        <div id="p_msg" class="muted" style="margin-top:8px"></div>
        <input id="p_id" type="hidden">
      </div>
      <!-- LIST PRODUITS -->
      <div class="card">
        <h3>Mes produits</h3>
        <div class="list" id="p_list"></div>
      </div>
    </div>
  </div>

  <!-- ======= MARCH√âS ======= -->
  <div id="tab-markets" class="hide">
    <div class="grid">
      <!-- FORM MARCH√â -->
      <div class="card">
        <h3 id="mktFormTitle">Nouveau march√©</h3>
        <div class="row3">
          <div>
            <label>Date</label>
            <input id="m_date" type="date">
          </div>
          <div>
            <label>Statut</label>
            <input id="m_status" type="text" placeholder="ex: Pr√©sent / Absent / Apr√®s-midi">
          </div>
          <div>
            <label>Ordre</label>
            <input id="m_order" type="number" value="0">
          </div>
        </div>
        <div class="row3">
          <div>
            <label>D√©but</label>
            <input id="m_start" type="time" value="08:00">
          </div>
          <div>
            <label>Fin</label>
            <input id="m_end" type="time" value="13:00">
          </div>
          <div>
            <label>Lieu</label>
            <input id="m_loc" type="text">
          </div>
        </div>
        <div>
          <label>Note</label>
          <textarea id="m_note" rows="2"></textarea>
        </div>
        <div style="display:flex;gap:10px;margin-top:12px">
          <button id="m_save" class="btn primary">Enregistrer</button>
          <button id="m_reset" class="btn">R√©initialiser</button>
          <button id="m_del" class="btn danger hide">Supprimer</button>
        </div>
        <div id="m_msg" class="muted" style="margin-top:8px"></div>
        <input id="m_id" type="hidden">
      </div>
      <!-- LIST MARCH√âS -->
      <div class="card">
        <h3>Mes march√©s</h3>
        <div class="list" id="m_list"></div>
      </div>
    </div>
  </div>

</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, doc, setDoc, deleteDoc, onSnapshot, query, orderBy, Timestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDd-wmlJDIScJSWNyefvlLNyurT3zAc_hk",
    authDomain: "site-vitrine-d2a44.firebaseapp.com",
    projectId: "site-vitrine-d2a44",
    storageBucket: "site-vitrine-d2a44.firebasestorage.app",
    messagingSenderId: "155990687587",
    appId: "1:155990687587:web:a6d449c3bf02e9eb17dd56"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const $ = s=>document.querySelector(s);
  const loginView=$('#loginView'), appView=$('#appView'), who=$('#who');

  // AUTH
  $('#login').onclick=async()=>{
    try{
      await signInWithEmailAndPassword(auth,$('#email').value,$('#pass').value);
    }catch(e){$('#loginMsg').textContent=e.message;}
  };
  $('#logout').onclick=()=>signOut(auth);

  onAuthStateChanged(auth,u=>{
    if(u){who.textContent=u.email;loginView.classList.add('hide');appView.classList.remove('hide');listenProducts();listenMarkets();}
    else{who.textContent='';loginView.classList.remove('hide');appView.classList.add('hide');}
  });

  // PRODUITS
  const pCol=collection(db,"products");
  function listenProducts(){ onSnapshot(query(pCol,orderBy('order','asc')),snap=>{
    $('#p_list').innerHTML='';
    snap.forEach(d=>{
      const p=d.data();
      const el=document.createElement('div');
      el.className='item';
      el.innerHTML=`<img src="${p.imageUrl||''}"><div><b>${p.name||''}</b> <span class="pill">${p.category||''}</span></div><div><button class="btn">√âditer</button></div>`;
      $('#p_list').appendChild(el);
    });
  });}

  // MARCH√âS
  const mCol=collection(db,"markets");
  function listenMarkets(){ onSnapshot(query(mCol,orderBy('date','asc')),snap=>{
    $('#m_list').innerHTML='';
    snap.forEach(d=>{
      const m=d.data(),dt=m.date?.toDate?.();
      const el=document.createElement('div');
      el.className='item';
      el.innerHTML=`<div style="width:64px;height:64px;display:grid;place-items:center">üìÖ</div>
        <div><b>${dt?dt.toLocaleDateString('fr-FR'):'‚Äî'}</b> <span class="pill">${m.status||''}</span>
        <div class="muted">${m.startHH||''} ‚Äì ${m.endHH||''} ${m.location?(' ¬∑ '+m.location):''}</div></div>`;
      $('#m_list').appendChild(el);
    });
  });}
</script>
</body>
</html>
